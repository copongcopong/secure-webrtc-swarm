# Algorithm

The aim is to encrypt the WebRTC signaling data using public-key authenticated encryption. The inital key material is transferred from one party to the other out-of-band. Based on that the remaining required key material is securely delivered in-band using public-key signatures.

All parties use their `pubKey` as `UUID` (= address) when connected to `signalhub`.

1. **A** sends an out-of-band invitation to **B** containing: `pubKey(A)`, `signPrivKey(AB)`.
2. **B** now recognizes `UUID(A)` in `/all` because of the invitation from **A**.
3. **B** sends crypto data to `/A` namely `signPubKey(AB)` and `pubKey(B)` signed using `signPrivKey(AB)`.
4. **A** verifies and accepts `pubKey(B)` using `signPubKey(AB)`.
5. **A** now sends encrypted/signed packages to `/B` using `pubKey(B)` and `privKey(A)`.
6. **B** receives encrypted/signed packages from **A** and knows that the algorithm is complete.

## Integration into `webrtc-swarm`

`wrap` and `unwrap` will be attached to the `opts` object that is passed into [`webrtc-swarm`](https://github.com/mafintosh/webrtc-swarm).

### `wrap`

```
- `/all`
  - No encryption - plain text.
- `/B`
  - **Key Exchange and Encryption** <sup>(see step 3 above)</sup>
    Holds an open invitation and thus knows that **B** still needs `pubKey(A)`.
    Has `pubKey(B)` and `signPrivKey(AB)` available from the invitation.
    - Sends `pubKey(A)` and the signature generated by using `signPrivKey(AB)`.
    - Attaches `signPubKey(AB)`.
    - Encrypts/signs WebRTC signaling data using `pubKey(B)` and `privKey(A)`.
  - **Just Encryption**
    Holds no open invitation regarding **B**.
    - Encrypts/signs using `pubKey(B)` and `privKey(A)`.
```

### `unwrap`

```
- `/all`
  - **Whitelist**
    Recognizes `UUID(B)`.
- `/A`
  - **Key Exchange and Encryption** <sup>(see step 4 above)</sup>
    Does not recognize `UUID(B)`.
    Recognizes the attached `signPubKey(AB)` since there is an open invitation.
    - Verifies signature of attached `pubKey(B)` using `signPubKey(AB)`.
      - Marks the invitation as complete.
      - Decrypts/verifies WebRTC signaling data using `privKey(A)` and `pubKey(B)`.
  - **Just Encryption**
    Recognizes `UUID(B)`.
    - If there is an open invite regarding **B** it will be marked complete.
    - Decrypts/verifies using `privKey(A)` and `pubKey(B)`.
```
